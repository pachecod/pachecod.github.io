<!DOCTYPE html>
<html lang="en" class="a-fullscreen">
<head>
    <meta charset="UTF-8">
    <title>Outdoor Exploration Museum</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
    <script src="https://unpkg.com/aframe-thumb-controls-component@1.1.0/dist/aframe-thumb-controls-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    
    <!-- Mobile Console for Debugging - Removed to fix 404 error -->
    
    <!-- Error handling for THREE.js compatibility -->
    <script>
        // Handle THREE.js compatibility issues
        window.addEventListener('error', function(e) {
            if (e.message.includes('THREE.Geometry') || e.message.includes('THREE.Math')) {
                console.warn('THREE.js compatibility issue suppressed:', e.message);
                e.preventDefault();
                return true;
            }
        });
    </script>
    
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #scene { width: 100vw; height: 100vh; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; }
        .museum-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            max-width: 300px;
            z-index: 100;
            display: none;
        }
        .vr-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            z-index: 100;
        }
    </style>

    <!-- Custom Components -->
    <script>
        // Face-camera component to keep elements facing the camera
        AFRAME.registerComponent("face-camera", {
            schema: {
                preserveY: { type: "boolean", default: false }
            },
            tick: function () {
                var camera = document.querySelector("[camera]");
                if (!camera) return;
                
                if (this.data.preserveY) {
                    var cameraPosition = camera.object3D.position.clone();
                    var objPosition = this.el.object3D.position.clone();
                    cameraPosition.y = objPosition.y;
                    this.el.object3D.lookAt(cameraPosition);
                } else {
                    this.el.object3D.lookAt(camera.object3D.position);
                }
            }
        });

        // Enhanced mobile movement with better controls
        AFRAME.registerComponent("enhanced-mobile-controls", {
            schema: {
                speed: { type: "number", default: 2 }
            },
            init: function () {
                var self = this;
                this.numFingers = 0;
                this.verticalMovementLocked = true;
                
                this.updateTouches = function (event) {
                    // Prevent default to stop scrolling and other touch behaviors
                    event.preventDefault();
                    self.numFingers = event.touches.length;
                };
                
                this.clearTouches = function (event) {
                    // Prevent default to stop scrolling and other touch behaviors
                    event.preventDefault();
                    self.numFingers = (event.touches && event.touches.length) || 0;
                };
                
                this.el.sceneEl.addEventListener("renderstart", function () {
                    var canvas = self.el.sceneEl.canvas;
                    // Use passive: false for movement controls to work properly
                    canvas.addEventListener("touchstart", self.updateTouches, { passive: false });
                    canvas.addEventListener("touchmove", self.updateTouches, { passive: false });
                    canvas.addEventListener("touchend", self.clearTouches, { passive: false });
                    canvas.addEventListener("touchcancel", self.clearTouches, { passive: false });
                });
                
                // Initialize mobile controls safely
                try {
                    if (AFRAME.utils.device.isMobile()) {
                        var leftCtrl = document.querySelector("#left-controller");
                        var rightCtrl = document.querySelector("#right-controller");
                        if (leftCtrl) {
                            leftCtrl.removeAttribute("blink-controls");
                        }
                        if (rightCtrl) {
                            rightCtrl.removeAttribute("blink-controls");
                        }
                    }
                } catch (error) {
                    console.warn('Error initializing mobile controls:', error);
                }
                
                const controlsGuide = document.createElement('div');
                controlsGuide.className = 'controls-guide';
                controlsGuide.innerHTML = 'Touch screen to move:<br>• One thumb down - Move forward<br>• Two thumbs down - Move backward<br>• Look around to change direction';
                document.body.appendChild(controlsGuide);
                
                setTimeout(() => {
                    controlsGuide.style.opacity = '0';
                    controlsGuide.style.transition = 'opacity 1s ease';
                    setTimeout(() => {
                        controlsGuide.style.display = 'none';
                    }, 1000);
                }, 5000);
            },
            tick: function (time, deltaTime) {
                if (this.numFingers === 0) {
                    return;
                }
                
                var distance = this.data.speed * (deltaTime / 1000);
                var moveMultiplier = this.numFingers === 1 ? -1 : 1; // One thumb forward, two thumbs backward
                
                var cameraEl = this.el.querySelector("[camera]");
                if (cameraEl) {
                    var direction = new THREE.Vector3();
                    cameraEl.object3D.getWorldDirection(direction);
                    
                    if (this.verticalMovementLocked) {
                        direction.y = 0;
                        direction.normalize();
                    }
                    
                    direction.multiplyScalar(distance * moveMultiplier);
                    this.el.object3D.position.add(direction);
                    this.el.object3D.position.y = 0;
                }
            },
            remove: function () {
                var canvas = this.el.sceneEl.canvas;
                canvas.removeEventListener("touchstart", this.updateTouches);
                canvas.removeEventListener("touchmove", this.updateTouches);
                canvas.removeEventListener("touchend", this.clearTouches);
                canvas.removeEventListener("touchcancel", this.clearTouches);
            }
        });

        // Spot component for hotspot behavior with enhanced functionality
        AFRAME.registerComponent("spot", {
            schema: {
                linkto: { type: "string", default: "" },
                spotgroup: { type: "string", default: "" },
                label: { type: "string", default: "" },
                audio: { type: "selector", default: null },
                labelBackground: { type: "string", default: "#000000" },
                info: { type: "string", default: "" },
                vegetableModel: { type: "string", default: "" },
                revealAnimation: { type: "boolean", default: false }
            },
            init: function () {
                var data = this.data;
                var el = this.el;
                
                // Create hotspot visual
                el.setAttribute("geometry", { primitive: "circle", radius: 0.5 });
                el.setAttribute("material", {
                    color: "#FFFFFF",
                    opacity: 0.6,
                    transparent: true,
                    src: "",
                });
                
                // Add pulse animation
                el.setAttribute("animation__pulse", {
                    property: "scale",
                    dir: "alternate",
                    dur: 1000,
                    easing: "easeInOutSine",
                    loop: true,
                    to: "1.1 1.1 1.1"
                });
                
                // Set up audio controls
                this.isPlaying = false;
                this.gazeTimeout = null;
                this.gazeThreshold = 1500; // 1.5 seconds gaze to activate
                
                // Create audio control buttons (always create them)
                // Container for audio controls
                this.audioControls = document.createElement("a-entity");
                this.audioControls.setAttribute("position", "0 -0.8 0");
                
                // Play button
                this.playButton = document.createElement("a-entity");
                this.playButton.setAttribute("geometry", "primitive: circle; radius: 0.25");
                this.playButton.setAttribute("material", "color: #4CAF50; opacity: 0.9");
                this.playButton.setAttribute("position", "-0.3 0 0");
                this.playButton.setAttribute("class", "clickable");
                
                // Play icon (triangle)
                const playIcon = document.createElement("a-entity");
                playIcon.setAttribute("geometry", "primitive: triangle; vertexA: 0.15 0 0; vertexB: -0.05 0.1 0; vertexC: -0.05 -0.1 0");
                playIcon.setAttribute("material", "color: white; shader: flat");
                playIcon.setAttribute("position", "-0.05 0 0.01");
                this.playButton.appendChild(playIcon);
                
                // Pause button
                this.pauseButton = document.createElement("a-entity");
                this.pauseButton.setAttribute("geometry", "primitive: circle; radius: 0.25");
                this.pauseButton.setAttribute("material", "color: #F44336; opacity: 0.9");
                this.pauseButton.setAttribute("position", "0.3 0 0");
                this.pauseButton.setAttribute("class", "clickable");
                
                // Pause icon (two rectangles)
                const pauseBarLeft = document.createElement("a-entity");
                pauseBarLeft.setAttribute("geometry", "primitive: box; width: 0.06; height: 0.15; depth: 0.01");
                pauseBarLeft.setAttribute("material", "color: white; shader: flat");
                pauseBarLeft.setAttribute("position", "-0.04 0 0.01");
                this.pauseButton.appendChild(pauseBarLeft);
                
                const pauseBarRight = document.createElement("a-entity");
                pauseBarRight.setAttribute("geometry", "primitive: box; width: 0.06; height: 0.15; depth: 0.01");
                pauseBarRight.setAttribute("material", "color: white; shader: flat");
                pauseBarRight.setAttribute("position", "0.04 0 0.01");
                this.pauseButton.appendChild(pauseBarRight);
                
                // Add all controls to container
                this.audioControls.appendChild(this.playButton);
                this.audioControls.appendChild(this.pauseButton);
                el.appendChild(this.audioControls);
                
                // Initially hide controls
                this.audioControls.setAttribute("visible", false);
                
                // Set up event listeners for audio buttons
                this.playButton.addEventListener("click", () => {
                    console.log('Play button clicked, audio data:', data.audio);
                    if (data.audio) {
                        this.playAudio();
                    }
                });
                
                this.pauseButton.addEventListener("click", () => {
                    console.log('Pause button clicked, audio data:', data.audio);
                    if (data.audio) {
                        this.pauseAudio();
                    }
                });
                
                // Setup gaze tracking for controls (moved outside audio check)
                el.addEventListener("mouseenter", () => {
                    // Show controls on mouse enter
                    if (this.audioControls) {
                        this.audioControls.setAttribute("visible", true);
                        
                        // Set gaze timeout for audio if available
                        if (data.audio) {
                            this.gazeTimeout = setTimeout(() => {
                                // Toggle audio play/pause after threshold
                                if (this.isPlaying) {
                                    this.pauseAudio();
                                } else {
                                    this.playAudio();
                                }
                            }, this.gazeThreshold);
                        }
                    }
                });
                
                el.addEventListener("mouseleave", () => {
                    // Hide controls on mouse leave after delay
                    setTimeout(() => {
                        if (!this.isPlaying && this.audioControls) {
                            this.audioControls.setAttribute("visible", false);
                        }
                    }, 1000);
                    
                    // Clear gaze timeout
                    if (this.gazeTimeout) {
                        clearTimeout(this.gazeTimeout);
                        this.gazeTimeout = null;
                    }
                });
                
                // Create label if provided
                if (data.label) {
                    var textEntity = document.createElement("a-text");
                    textEntity.setAttribute("value", data.label);
                    textEntity.setAttribute("align", "center");
                    textEntity.setAttribute("position", "0 0.6 0");
                    textEntity.setAttribute("scale", "0.5 0.5 0.5");
                    textEntity.setAttribute("color", "#FFFFFF");
                    
                    var bgEntity = document.createElement("a-plane");
                    bgEntity.setAttribute("color", data.labelBackground);
                    bgEntity.setAttribute("position", "0 0.6 -0.01");
                    bgEntity.setAttribute("width", data.label.length * 0.15 + 0.2);
                    bgEntity.setAttribute("height", "0.3");
                    bgEntity.setAttribute("opacity", "0.8");
                    
                    el.appendChild(bgEntity);
                    el.appendChild(textEntity);
                }
                
                // Set up click event
                el.addEventListener("click", () => {
                    // Handle group visibility if specified
                    if (data.spotgroup) {
                        var allGroups = document.querySelectorAll('[id^="group-"]');
                        allGroups.forEach(function (group) {
                            group.setAttribute("visible", false);
                        });
                        var targetGroup = document.querySelector("#" + data.spotgroup);
                        if (targetGroup) {
                            targetGroup.setAttribute("visible", true);
                        }
                    }
                    
                    // Show info panel if specified
                    if (data.info) {
                        const infoPanel = document.querySelector('.museum-info');
                        if (infoPanel) {
                            infoPanel.textContent = data.info;
                            infoPanel.style.display = 'block';
                            
                            // Hide after 10 seconds
                            setTimeout(() => {
                                infoPanel.style.display = 'none';
                            }, 10000);
                        }
                    }
                    
                    // Handle 3D model animation if specified
                    if (data.vegetableModel) {
                        const model = document.querySelector(data.vegetableModel);
                        if (model && data.revealAnimation) {
                            // Check if already animating to prevent stacking
                            if (model.getAttribute("data-animating") === "true") {
                                return; // Already animating, don't start another
                            }
                            
                            // Mark as animating
                            model.setAttribute("data-animating", "true");
                            
                            // Remove any existing animations first
                            model.removeAttribute("animation__spin");
                            
                            // Create spin animation only
                            model.setAttribute("animation__spin", {
                                property: "rotation",
                                to: "0 360 0",
                                loop: 1,
                                dur: 2000,
                                easing: "easeOutQuad"
                            });
                            
                            // Reset animation state after spin completes
                            setTimeout(() => {
                                model.removeAttribute("animation__spin");
                                model.removeAttribute("data-animating");
                            }, 2000); // Wait for spin animation to complete
                        }
                    }

                    // Teleport if linkto is specified
                    if (data.linkto && data.linkto !== "") {
                        var targetPoint = document.querySelector(data.linkto);
                        if (targetPoint) {
                            // Add a flash effect before teleport
                            document.querySelector('a-scene').setAttribute('animation__flash', {
                                property: 'background.color',
                                from: '#000',
                                to: '#fff',
                                dur: 100,
                                dir: 'alternate',
                                loop: 2
                            });
                            
                            setTimeout(() => {
                                var cameraRig = document.querySelector("#cameraRig");
                                cameraRig.setAttribute("position", targetPoint.getAttribute("position"));
                            }, 200);
                        }
                    }
                });
            },
            
                playAudio: function() {
                    console.log('playAudio called, audio data:', this.data.audio);
                    if (this.data.audio) {
                        // In A-Frame, data.audio should be the actual element when using selector syntax
                        const audioElement = this.data.audio;
                        console.log('Audio element:', audioElement);
                        if (audioElement) {
                            // Check if audio is ready to play
                            if (audioElement.readyState >= 2) { // HAVE_CURRENT_DATA
                                // Stop any other playing audio
                                document.querySelectorAll('audio').forEach(audio => {
                                    if (audio !== audioElement) {
                                        audio.pause();
                                        audio.currentTime = 0;
                                        
                                        // Reset other hotspots' play state
                                        document.querySelectorAll('[spot]').forEach(spot => {
                                            if (spot !== this.el && spot.components.spot) {
                                                spot.components.spot.isPlaying = false;
                                            }
                                        });
                                    }
                                });
                                
                                // Play this audio
                                console.log('Attempting to play audio...');
                                audioElement.play().then(() => {
                                    console.log('Audio started playing successfully');
                                    this.isPlaying = true;
                                    
                                    // Visual feedback for playing state
                                    this.playButton.setAttribute("material", "opacity", 0.4);
                                    this.pauseButton.setAttribute("material", "opacity", 0.9);
                                }).catch(error => {
                                    console.error('Error playing audio:', error);
                                });
                            } else {
                                console.log('Audio not ready, waiting for load...');
                                audioElement.addEventListener('canplay', () => {
                                    console.log('Audio loaded, retrying play...');
                                    this.playAudio();
                                }, { once: true });
                            }
                        } else {
                            console.error('Audio element not found for:', this.data.audio);
                        }
                    } else {
                        console.log('No audio data available');
                    }
                },
                
                pauseAudio: function() {
                    if (this.data.audio) {
                        const audioElement = this.data.audio;
                        if (audioElement) {
                            audioElement.pause();
                            this.isPlaying = false;
                            
                            // Visual feedback for paused state
                            this.playButton.setAttribute("material", "opacity", 0.9);
                            this.pauseButton.setAttribute("material", "opacity", 0.4);
                        }
                    }
                }
        });

        // Sound effect component
        AFRAME.registerComponent('sound-effects', {
            init: function() {
                const config = {"name":"Outdoor Exploration Museum","created":"2025-01-27T00:00:00.000Z","version":"1.0","description":"Open-air farm/field with exhibits and hotspots. Current default experience.","template":{"id":"outdoor-exploration","name":"Outdoor Exploration"},"assets":{"images":{"image1":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/berrypicking_1758474111736.png","image2":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/field_1758474106342.png","image3":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/tomatotent_1758474109563.png","arrowLeft":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/left_1758485303552.png","arrowRight":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/right_1758485302607.png","grid":"images/border.jpg","sky":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg","ground":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/leaves_1758475586342.png","hotspot":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/hotspot_1758485223541.png"},"models":{"tomato":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb","eggplant":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb","onion":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb","tomato-model":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb?t=1759352144049","eggplant-model":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb?t=1759352144049","onion-model":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb?t=1759352144049"},"audio":{"audio1":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio1_1758484808064.mp3","audiocarrots":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio2_1758484807815.mp3","audioonion":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio3_1758484807193.mp3","ambient":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/newtest/audio/meadowfield2_1754926586672.mp3","click":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/admin/audio/click_1758493161872.mp3","teleport":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/teleport_1758484984809.mp3"}},"environment":{"sky":{"day":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg","night":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg"},"ground":{"texture":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/leaves_1758475586342.png","repeat":"10 10","size":"100 100"},"lighting":{"ambient":{"color":"#BBB","intensity":1},"directional":{"color":"#FFF","intensity":1,"position":"-1 1 0","castShadow":true}},"physics":{"floor":{"position":"0 -0.1 0","size":"100 0.2 100","visible":false},"ceiling":{"position":"0 4 0","size":"100 0.2 100","visible":false}}},"infoDisplay":{"position":"0 0 -5","panel":{"position":"0 2.6 -4","size":"4 2.5","images":["#image1","#image2","#image3"]},"navigation":{"left":{"position":"-2.3 0 0","size":"0.6 0.6"},"right":{"position":"2.3 0 0","size":"0.6 0.6"}},"text":{"position":"0 -1.6 0","size":"4 0.8","content":{"slide1":"Berry picking!","slide2":"This is a field","slide3":"This is a tomato tent."}},"rotation":"0 0 0"},"exhibits":[{"id":"tomato-exhibit","name":"Tomato Exhibit","position":"-15 0 -17","model":{"id":"tomato-model","src":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb?t=1759352144049","position":"0 1 0","scale":"1 1 1","rotation":"0 0 0","castShadow":true},"environment":{"geometry":"primitive: cylinder; radius: 5; height: 0.1","position":"0 0 0","material":"color: #2D5F34; roughness: 0.9"},"hotspot":{"id":"tomato-hotspot","position":"3 1.5 0","label":"Tomato on Crate","audio":"#audio1","info":"This is a caption for the tomato exhibit.","vegetableModel":"tomato-model","revealAnimation":true},"additionalModels":[{"id":"additional_model_1759352165061","name":"Vase","url":"https://vlyzifpqemfanxllnmuf.supabase.co/storage/v1/object/public/files/student1/3d/1962.281-tripod-ding_1759352084673.glb","position":"0 3.4 5.7","rotation":"0 0 0","scale":"30 30 30","visible":true}]},{"id":"eggplant-exhibit","name":"Eggplant Exhibit","position":"-5 0 15","model":{"id":"eggplant-model","src":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb?t=1759352144049","position":"0 1 0","scale":"1 1 1","rotation":"0 0 0","castShadow":true},"environment":{"geometry":"primitive: cylinder; radius: 5; height: 0.1","position":"0 0 0","material":"color: #E6B570; roughness: 0.9"},"hotspot":{"id":"eggplant-hotspot","position":"3 1.5 0","label":"Eggplant Display","audio":"#audiocarrots","info":"This is a caption for the eggplant exhibit.","vegetableModel":"eggplant-model","revealAnimation":true}},{"id":"onion-exhibit","name":"Onion Exhibit","position":"13.6 0 2","model":{"id":"onion-model","src":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb?t=1759352144049","position":"0 1 0","scale":"1 1 1","rotation":"0 0 0","castShadow":true},"environment":{"geometry":"primitive: cylinder; radius: 5; height: 0.1","position":"0 0 0","material":"color: #B39DDB; roughness: 0.9"},"hotspot":{"id":"onion-hotspot","position":"3 1.5 0","label":"Onion Exhibit","audio":"#audioonion","info":"This is a caption for the onion exhibit.","vegetableModel":"onion-model","revealAnimation":true}}],"camera":{"position":"0 1.6 0","lookControls":{"pointerLockEnabled":true,"reverseMouseDrag":false},"wasdControls":{"fly":false}},"mobileControls":{"speed":3,"verticalMovementLocked":true},"dayNightCycle":{"enabled":false},"soundEffects":{"enabled":true,"ambientDelay":2000,"ambientAudioEnabled":false},"loading":{"enabled":true,"timeout":10000}};
                this.sounds = {
                    ambient: new Howl({
                        src: [config.assets?.audio?.ambient || ''],
                        loop: true,
                        volume: 0.3,
                        autoplay: false
                    }),
                    click: new Howl({
                        src: [config.assets?.audio?.click || ''],
                        volume: 0.5
                    }),
                    teleport: new Howl({
                        src: [config.assets?.audio?.teleport || ''],
                        volume: 0.7
                    })
                };
                
                // Only play ambient audio if enabled
                if (config.soundEffects?.ambientAudioEnabled) {
                    setTimeout(() => {
                        this.sounds.ambient.play();
                    }, config.soundEffects?.ambientDelay || 2000);
                }
                
                // Add click sound to all clickable elements, but prevent duplicates
                document.querySelectorAll('.clickable').forEach(el => {
                    // Check if this element already has a click sound listener
                    if (!el.hasAttribute('data-click-sound-added')) {
                        el.addEventListener('click', () => {
                            this.sounds.click.play();
                        });
                        el.setAttribute('data-click-sound-added', 'true');
                    }
                });
            }
        });
        
        // Static skybox component - always shows the configured skybox
        AFRAME.registerComponent('static-skybox', {
            init: function() {
                this.sky = document.querySelector('a-sky');
                const config = {"name":"Outdoor Exploration Museum","created":"2025-01-27T00:00:00.000Z","version":"1.0","description":"Open-air farm/field with exhibits and hotspots. Current default experience.","template":{"id":"outdoor-exploration","name":"Outdoor Exploration"},"assets":{"images":{"image1":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/berrypicking_1758474111736.png","image2":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/field_1758474106342.png","image3":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/tomatotent_1758474109563.png","arrowLeft":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/left_1758485303552.png","arrowRight":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/right_1758485302607.png","grid":"images/border.jpg","sky":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg","ground":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/leaves_1758475586342.png","hotspot":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/hotspot_1758485223541.png"},"models":{"tomato":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb","eggplant":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb","onion":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb","tomato-model":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb?t=1759352144049","eggplant-model":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb?t=1759352144049","onion-model":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb?t=1759352144049"},"audio":{"audio1":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio1_1758484808064.mp3","audiocarrots":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio2_1758484807815.mp3","audioonion":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio3_1758484807193.mp3","ambient":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/newtest/audio/meadowfield2_1754926586672.mp3","click":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/admin/audio/click_1758493161872.mp3","teleport":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/teleport_1758484984809.mp3"}},"environment":{"sky":{"day":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg","night":"https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg"},"ground":{"texture":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/leaves_1758475586342.png","repeat":"10 10","size":"100 100"},"lighting":{"ambient":{"color":"#BBB","intensity":1},"directional":{"color":"#FFF","intensity":1,"position":"-1 1 0","castShadow":true}},"physics":{"floor":{"position":"0 -0.1 0","size":"100 0.2 100","visible":false},"ceiling":{"position":"0 4 0","size":"100 0.2 100","visible":false}}},"infoDisplay":{"position":"0 0 -5","panel":{"position":"0 2.6 -4","size":"4 2.5","images":["#image1","#image2","#image3"]},"navigation":{"left":{"position":"-2.3 0 0","size":"0.6 0.6"},"right":{"position":"2.3 0 0","size":"0.6 0.6"}},"text":{"position":"0 -1.6 0","size":"4 0.8","content":{"slide1":"Berry picking!","slide2":"This is a field","slide3":"This is a tomato tent."}},"rotation":"0 0 0"},"exhibits":[{"id":"tomato-exhibit","name":"Tomato Exhibit","position":"-15 0 -17","model":{"id":"tomato-model","src":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb?t=1759352144049","position":"0 1 0","scale":"1 1 1","rotation":"0 0 0","castShadow":true},"environment":{"geometry":"primitive: cylinder; radius: 5; height: 0.1","position":"0 0 0","material":"color: #2D5F34; roughness: 0.9"},"hotspot":{"id":"tomato-hotspot","position":"3 1.5 0","label":"Tomato on Crate","audio":"#audio1","info":"This is a caption for the tomato exhibit.","vegetableModel":"tomato-model","revealAnimation":true},"additionalModels":[{"id":"additional_model_1759352165061","name":"Vase","url":"https://vlyzifpqemfanxllnmuf.supabase.co/storage/v1/object/public/files/student1/3d/1962.281-tripod-ding_1759352084673.glb","position":"0 3.4 5.7","rotation":"0 0 0","scale":"30 30 30","visible":true}]},{"id":"eggplant-exhibit","name":"Eggplant Exhibit","position":"-5 0 15","model":{"id":"eggplant-model","src":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb?t=1759352144049","position":"0 1 0","scale":"1 1 1","rotation":"0 0 0","castShadow":true},"environment":{"geometry":"primitive: cylinder; radius: 5; height: 0.1","position":"0 0 0","material":"color: #E6B570; roughness: 0.9"},"hotspot":{"id":"eggplant-hotspot","position":"3 1.5 0","label":"Eggplant Display","audio":"#audiocarrots","info":"This is a caption for the eggplant exhibit.","vegetableModel":"eggplant-model","revealAnimation":true}},{"id":"onion-exhibit","name":"Onion Exhibit","position":"13.6 0 2","model":{"id":"onion-model","src":"https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb?t=1759352144049","position":"0 1 0","scale":"1 1 1","rotation":"0 0 0","castShadow":true},"environment":{"geometry":"primitive: cylinder; radius: 5; height: 0.1","position":"0 0 0","material":"color: #B39DDB; roughness: 0.9"},"hotspot":{"id":"onion-hotspot","position":"3 1.5 0","label":"Onion Exhibit","audio":"#audioonion","info":"This is a caption for the onion exhibit.","vegetableModel":"onion-model","revealAnimation":true}}],"camera":{"position":"0 1.6 0","lookControls":{"pointerLockEnabled":true,"reverseMouseDrag":false},"wasdControls":{"fly":false}},"mobileControls":{"speed":3,"verticalMovementLocked":true},"dayNightCycle":{"enabled":false},"soundEffects":{"enabled":true,"ambientDelay":2000,"ambientAudioEnabled":false},"loading":{"enabled":true,"timeout":10000}};
                
                // Set the skybox to the configured sky image and keep it static
                const skyImage = config.environment?.sky?.day || config.assets?.images?.sky || '';
                
                if (this.sky) {
                    this.sky.setAttribute('material', {
                        src: skyImage,
                        opacity: 1.0
                    });
                    console.log('Static skybox set to:', skyImage);
                }
                
                // Create ambient light - use config values
                this.ambientLight = document.createElement('a-entity');
                this.ambientLight.setAttribute('light', {
                    type: 'ambient',
                    color: config?.environment?.lighting?.ambient?.color || '#BBB',
                    intensity: config?.environment?.lighting?.ambient?.intensity || 1
                });
                this.el.sceneEl.appendChild(this.ambientLight);
                
                // Create a static directional light (no movement) - use config values
                this.sunLight = document.createElement('a-entity');
                this.sunLight.setAttribute('light', {
                    type: 'directional',
                    color: config?.environment?.lighting?.directional?.color || '#FFF',
                    intensity: config?.environment?.lighting?.directional?.intensity || 0.8,
                    castShadow: config?.environment?.lighting?.directional?.castShadow || true
                });
                this.sunLight.setAttribute('position', config?.environment?.lighting?.directional?.position || '0 10 0');
                this.el.sceneEl.appendChild(this.sunLight);
            }
        });
    </script>
</head>

<body>
    <a-scene 
        cursor="rayOrigin: mouse; objects: .clickable" 
        sound-effects
        static-skybox>
        <!-- Lighting handled by static-skybox component -->
        
        <!-- UI Overlays -->
        <div class="museum-info">Welcome to the Outdoor Exploration Museum</div>
        
        <!-- Camera Rig with Enhanced Controls -->
        <a-entity
            id="cameraRig"
            enhanced-mobile-controls="speed: 3"
            movement-controls="fly: false; constrainToNavMesh: false;"
            navigator="cameraRig: #cameraRig; cameraHead: #head; collisionEntities: .collision; ignoreEntities: .clickable"
            position="0 0 0"
            rotation="0 0 0"
        >
            <a-entity
                id="head"
                camera="active: true"
                look-controls="pointerLockEnabled: true; reverseMouseDrag: false"
                wasd-controls="fly: false"
                position="0 1.6 0"
            >
                <a-cursor
                    fuse="true"
                    fuse-timeout="1500"
                    animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                    animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
                    animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1"
                    raycaster="objects: .clickable"
                    visible="true"
                ></a-cursor>
            </a-entity>

            <!-- Controllers with improved teleportation -->
            <a-entity
                id="left-controller"
                laser-controls="hand: left"
                raycaster="objects: .clickable, .ground"
                blink-controls="cameraRig: #cameraRig; teleportOrigin: #cameraRig; collisionEntities: .ground; landingMaxAngle: 45; buttonTopoOffset: 0.1"
                visible="true"
            ></a-entity>
            
            <a-entity
                id="right-controller"
                laser-controls="hand: right"
                raycaster="objects: .clickable, .ground"
                blink-controls="cameraRig: #cameraRig; teleportOrigin: #cameraRig; collisionEntities: .ground; landingMaxAngle: 45; buttonTopoOffset: 0.1"
                visible="true"
            ></a-entity>
        </a-entity>

        <!-- Assets -->
        <a-assets>
            <!-- Sky and Ground -->
            <img id="sky" src="https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/Dan%20Pacheco/images/1_1753114668355.jpg" />
            <img id="ground" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/leaves_1758475586342.png" />
            
            <!-- Slideshow Images -->
            <img id="image1" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/berrypicking_1758474111736.png" />
            <img id="image2" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/field_1758474106342.png" />
            <img id="image3" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/tomatotent_1758474109563.png" />
            <img id="arrowLeft" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/left_1758485303552.png" />
            <img id="arrowRight" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/images/right_1758485302607.png" />
            
            <!-- 3D Models -->
                        <a-asset-item id="tomato" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb" type="gltf"></a-asset-item>
            <a-asset-item id="eggplant" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb" type="gltf"></a-asset-item>
            <a-asset-item id="onion" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb" type="gltf"></a-asset-item>
            <a-asset-item id="tomato-model" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb?t=1759352144049" type="gltf"></a-asset-item>
            <a-asset-item id="eggplant-model" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb?t=1759352144049" type="gltf"></a-asset-item>
            <a-asset-item id="onion-model" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb?t=1759352144049" type="gltf"></a-asset-item>
            <audio id="audio1" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio1_1758484808064.mp3" preload="auto"></audio>
            <audio id="audiocarrots" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio2_1758484807815.mp3" preload="auto"></audio>
            <audio id="audioonion" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/audio3_1758484807193.mp3" preload="auto"></audio>
            <audio id="ambient" src="https://hkfsgnludtapbbtsacwd.supabase.co/storage/v1/object/public/files/newtest/audio/meadowfield2_1754926586672.mp3" preload="auto"></audio>
            <audio id="click" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/admin/audio/click_1758493161872.mp3" preload="auto"></audio>
            <audio id="teleport" src="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/audio/teleport_1758484984809.mp3" preload="auto"></audio>

        </a-assets>

        <!-- Environment -->
        
        <a-plane
            width="100"
            height="100"
            rotation="-90 0 0"
            material="src: #ground; repeat:10 10; transparent: false; opacity: 1; normalTextureRepeat: 10 10; roughness: 0.8"
            shadow="cast: false; receive: true"
            class="ground clickable"
        ></a-plane>

        <a-sky src="#sky"></a-sky>
        
        <!-- Interactive Info Display -->
        <a-entity id="info-display" position="0 0 -5">
            <!-- Main Display Panel with billboard behavior -->
            <a-entity 
                id="image-panel-container"
                face-camera
                position="0 2.6 -4"
            >
                <a-plane
                    id="image-panel"
                    position="0 0 0"
                    width="4"
                    height="2.5"
                    material="src: #image1; side: double; shader: flat"
                    visible="true"
                    class="clickable"
                ></a-plane>
                
                <!-- Navigation Arrows with Improved Styling -->
                <a-entity 
                    id="nav-left" 
                    position="-2.3 0 0" 
                    class="clickable"
                >
                    <a-image
                        src="#arrowLeft"
                        position="0 0 0.01"
                        scale="0.5 0.5 0.5"
                        class="clickable"
                        animation__hover="property: scale; to: 0.6 0.6 0.6; startEvents: mouseenter; endEvents: mouseleave; dir: alternate; dur: 300"
                    ></a-image>
                    <a-plane
                        width="0.6"
                        height="0.6"
                        color="#333333"
                        opacity="0.7"
                        material="shader: flat"
                    ></a-plane>
                </a-entity>
                
                <a-entity 
                    id="nav-right" 
                    position="2.3 0 0" 
                    class="clickable"
                >
                    <a-image
                        src="#arrowRight"
                        position="0 0 0.01"
                        scale="0.5 0.5 0.5"
                        class="clickable"
                        animation__hover="property: scale; to: 0.6 0.6 0.6; startEvents: mouseenter; endEvents: mouseleave; dir: alternate; dur: 300"
                    ></a-image>
                    <a-plane
                        width="0.6"
                        height="0.6"
                        color="#333333"
                        opacity="0.7"
                        material="shader: flat"
                    ></a-plane>
                </a-entity>
                
                <!-- Information Display Text -->
                <a-entity
                    id="info-text"
                    position="0 -1.6 0"
                    text="value: Welcome to the Outdoor Exploration Museum! Explore the world of exhibits in this interactive 3D experience. Click on the hotspots to learn more about each exhibit.; width: 3; color: #FFFFFF; align: center"
                    geometry="primitive: plane; width: 4; height: 0.8"
                    material="color: #333333; opacity: 0.8; shader: flat"
                ></a-entity>
            </a-entity>
        </a-entity>
        
        <!-- Create invisible floor collider -->
        <a-box
            class="collision"
            position="0 -0.1 0"
            width="100"
            height="0.2"
            depth="100"
            visible="false"
            static-body
        ></a-box>
        
        <!-- Walls and Ceilings -->
        
        
        <!-- Exhibits -->
        
        <!-- Tomato Exhibit -->
        <a-entity id="tomato-exhibit" position="-15 0 -17">
            <!-- 3D Model -->
            <a-entity id="tomato-model-model" 
                      gltf-model="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/tomato-plate_1758376233930.glb?t=1759352144049" 
                      position="0 1 0" 
                      scale="1 1 1" 
                      rotation="0 0 0"
                      shadow="cast: true; receive: true">
            </a-entity>
            
            <!-- Additional Models -->
            
            <!-- Additional Model: additional_model_1759352165061 -->
            <a-entity id="model-additional_model_1759352165061" 
                      gltf-model="https://vlyzifpqemfanxllnmuf.supabase.co/storage/v1/object/public/files/student1/3d/1962.281-tripod-ding_1759352084673.glb" 
                      position="0 3.4 5.7" 
                      scale="30 30 30" 
                      rotation="0 0 0"
                      visible="true"
                      shadow="cast: true; receive: true"
                      class="additional-model">
            </a-entity>

            
            <!-- Model Label -->
            <a-entity id="tomato-model-label-container" position="0 3 0" visible="false">
                <a-text value="Tomato Exhibit" 
                        align="center" 
                        color="white" 
                        position="0 0 0"
                        scale="2 2 2">
                </a-text>
            </a-entity>
            
            <!-- Hotspot -->
            <a-entity id="tomato-exhibit-hotspot" 
                      position="3 1.5 0"
                      face-camera="preserveY: true"
                      class="clickable"
                      spot="label: Tomato on Crate; info: This is a caption for the tomato exhibit.; audio: #audio1; vegetableModel: #tomato-model-model; revealAnimation: true">
            </a-entity>
        </a-entity>

        <!-- Eggplant Exhibit -->
        <a-entity id="eggplant-exhibit" position="-5 0 15">
            <!-- 3D Model -->
            <a-entity id="eggplant-model-model" 
                      gltf-model="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/eggplant_1758376225454.glb?t=1759352144049" 
                      position="0 1 0" 
                      scale="1 1 1" 
                      rotation="0 0 0"
                      shadow="cast: true; receive: true">
            </a-entity>
            
            <!-- Additional Models -->
            
            
            <!-- Model Label -->
            <a-entity id="eggplant-model-label-container" position="0 3 0" visible="false">
                <a-text value="Eggplant Exhibit" 
                        align="center" 
                        color="white" 
                        position="0 0 0"
                        scale="2 2 2">
                </a-text>
            </a-entity>
            
            <!-- Hotspot -->
            <a-entity id="eggplant-exhibit-hotspot" 
                      position="3 1.5 0"
                      face-camera="preserveY: true"
                      class="clickable"
                      spot="label: Eggplant Display; info: This is a caption for the eggplant exhibit.; audio: #audiocarrots; vegetableModel: #eggplant-model-model; revealAnimation: true">
            </a-entity>
        </a-entity>

        <!-- Onion Exhibit -->
        <a-entity id="onion-exhibit" position="13.6 0 2">
            <!-- 3D Model -->
            <a-entity id="onion-model-model" 
                      gltf-model="https://slrztqodtgjgexmeihdc.supabase.co/storage/v1/object/public/files/common-assets/3d/onions_1758376229101.glb?t=1759352144049" 
                      position="0 1 0" 
                      scale="1 1 1" 
                      rotation="0 0 0"
                      shadow="cast: true; receive: true">
            </a-entity>
            
            <!-- Additional Models -->
            
            
            <!-- Model Label -->
            <a-entity id="onion-model-label-container" position="0 3 0" visible="false">
                <a-text value="Onion Exhibit" 
                        align="center" 
                        color="white" 
                        position="0 0 0"
                        scale="2 2 2">
                </a-text>
            </a-entity>
            
            <!-- Hotspot -->
            <a-entity id="onion-exhibit-hotspot" 
                      position="3 1.5 0"
                      face-camera="preserveY: true"
                      class="clickable"
                      spot="label: Onion Exhibit; info: This is a caption for the onion exhibit.; audio: #audioonion; vegetableModel: #onion-model-model; revealAnimation: true">
            </a-entity>
        </a-entity>

        
        <script>
           // Document ready handler
           document.addEventListener("DOMContentLoaded", () => {
               // Debug: Log all audio elements
               console.log('All audio elements in DOM:');
               document.querySelectorAll('audio').forEach((audio, index) => {
                   console.log(`Audio ${index}:`, audio.id, audio.src);
               });
               
               // Image slideshow functionality
                const images = ["#image1","#image2","#image3"];
                let currentIndex = 0;
                const imagePanel = document.querySelector("#image-panel");
                
                function updatePanelImage() {
                    imagePanel.setAttribute("material", "src", images[currentIndex]);
                    
                    // Update info text based on current image
                    const infoText = document.querySelector("#info-text");
                    const content = {"slide1":"Berry picking!","slide2":"This is a field","slide3":"This is a tomato tent."};
                    let textContent = content.default || "Welcome to the Outdoor Exploration Museum!";
                    
                    switch(currentIndex) {
                        case 0:
                            textContent = content.slide1 || "Slide 1";
                            break;
                        case 1:
                            textContent = content.slide2 || "Slide 2";
                            break;
                        case 2:
                            textContent = content.slide3 || "Slide 3";
                            break;
                    }
                    
                    infoText.setAttribute("text", "value", textContent);
                }
                
                document.querySelector("#nav-left").addEventListener("click", () => {
                    currentIndex = (currentIndex - 1 + images.length) % images.length;
                    updatePanelImage();
                    // Play click sound if available
                    const soundEffects = document.querySelector('[sound-effects]');
                    if (soundEffects && soundEffects.components['sound-effects'].sounds.click) {
                        soundEffects.components['sound-effects'].sounds.click.play();
                    }
                });
                
                document.querySelector("#nav-right").addEventListener("click", () => {
                    currentIndex = (currentIndex + 1) % images.length;
                    updatePanelImage();
                    // Play click sound if available
                    const soundEffects = document.querySelector('[sound-effects]');
                    if (soundEffects && soundEffects.components['sound-effects'].sounds.click) {
                        soundEffects.components['sound-effects'].sounds.click.play();
                    }
                });
                
                // Update hotspots to use the preserveY option
                document.querySelectorAll('[face-camera]').forEach(el => {
                    // Check if this is a hotspot element (not the image panel)
                    if (el.hasAttribute('spot')) {
                        el.setAttribute('face-camera', 'preserveY', true);
                    }
                });
                
                // VR Mode toggle
                const vrToggle = document.createElement('div');
                vrToggle.className = 'vr-toggle';
                vrToggle.textContent = 'Enter VR';
                document.body.appendChild(vrToggle);
                
                vrToggle.addEventListener('click', () => {
                    const scene = document.querySelector('a-scene');
                    if (scene.is('vr-mode')) {
                        scene.exitVR();
                        vrToggle.textContent = 'Enter VR';
                    } else {
                        scene.enterVR();
                        vrToggle.textContent = 'Exit VR';
                    }
                });
                
                // Detect device capabilities
                setTimeout(() => {
                    if (AFRAME.utils.device.isMobile()) {
                        // Mobile controls guide would go here
                    } else {
                        // Desktop controls guide would go here
                    }
                }, 1000);
            });
        </script>
    </a-scene>
</body>
</html>